# frozen_string_literal: true

require 'date'

RSpec.describe SgroupBy do
  it "has a version number" do
    expect(SgroupBy::VERSION).not_to be nil
  end

  it "groups enum with forward matching." do
    releases = [
      { version: 'Ruby 3.1.2',  date: '2022-04-12' },
      { version: 'Ruby 3.0.4',  date: '2022-04-12' },
      { version: 'Ruby 2.7.6',  date: '2022-04-12' },
      { version: 'Ruby 2.6.10', date: '2022-04-12' },
      { version: 'Ruby 3.1.1',  date: '2022-02-18' },
      { version: 'Ruby 3.1.0',  date: '2021-12-25' },
      { version: 'Ruby 3.0.3',  date: '2021-11-24' },
      { version: 'Ruby 2.7.5',  date: '2021-11-24' },
      { version: 'Ruby 2.6.9',  date: '2021-11-24' },
      { version: 'Ruby 3.0.2',  date: '2021-07-07' },
      { version: 'Ruby 2.7.4',  date: '2021-07-07' },
      { version: 'Ruby 2.6.8',  date: '2021-07-07' },
      { version: 'Ruby 3.0.1',  date: '2021-04-05' },
      { version: 'Ruby 2.7.3',  date: '2021-04-05' },
      { version: 'Ruby 2.6.7',  date: '2021-04-05' },
      { version: 'Ruby 2.5.9',  date: '2021-04-05' },
      { version: 'Ruby 3.0.0',  date: '2020-12-25' },
      { version: 'Ruby 2.7.2',  date: '2020-10-02' },
      { version: 'Ruby 2.7.1',  date: '2020-03-31' },
      { version: 'Ruby 2.6.6',  date: '2020-03-31' },
      { version: 'Ruby 2.5.8',  date: '2020-03-31' },
      { version: 'Ruby 2.4.10', date: '2020-03-31' },
      { version: 'Ruby 2.7.0',  date: '2019-12-25' },
      { version: 'Ruby 2.4.9',  date: '2019-10-02' },
      { version: 'Ruby 2.6.5',  date: '2019-10-01' },
      { version: 'Ruby 2.5.7',  date: '2019-10-01' },
      { version: 'Ruby 2.4.8',  date: '2019-10-01' },
      { version: 'Ruby 2.6.4',  date: '2019-08-28' },
      { version: 'Ruby 2.5.6',  date: '2019-08-28' },
      { version: 'Ruby 2.4.7',  date: '2019-08-28' },
      { version: 'Ruby 2.6.3',  date: '2019-04-17' },
      { version: 'Ruby 2.4.6',  date: '2019-04-01' },
      { version: 'Ruby 2.5.5',  date: '2019-03-15' },
      { version: 'Ruby 2.6.2',  date: '2019-03-13' },
      { version: 'Ruby 2.5.4',  date: '2019-03-13' },
      { version: 'Ruby 2.6.1',  date: '2019-01-30' },
      { version: 'Ruby 2.6.0',  date: '2018-12-25' },
      { version: 'Ruby 2.5.3',  date: '2018-10-18' },
      { version: 'Ruby 2.5.2',  date: '2018-10-17' },
      { version: 'Ruby 2.4.5',  date: '2018-10-17' },
      { version: 'Ruby 2.3.8',  date: '2018-10-17' },
      { version: 'Ruby 2.5.1',  date: '2018-03-28' },
      { version: 'Ruby 2.4.4',  date: '2018-03-28' },
      { version: 'Ruby 2.3.7',  date: '2018-03-28' },
      { version: 'Ruby 2.2.10', date: '2018-03-28' },
      { version: 'Ruby 2.5.0',  date: '2017-12-25' },
      { version: 'Ruby 2.4.3',  date: '2017-12-14' },
      { version: 'Ruby 2.3.6',  date: '2017-12-14' },
      { version: 'Ruby 2.2.9',  date: '2017-12-14' },
      { version: 'Ruby 2.4.2',  date: '2017-09-14' },
      { version: 'Ruby 2.3.5',  date: '2017-09-14' },
      { version: 'Ruby 2.2.8',  date: '2017-09-14' },
      { version: 'Ruby 2.3.4',  date: '2017-03-30' },
      { version: 'Ruby 2.2.7',  date: '2017-03-28' },
      { version: 'Ruby 2.4.1',  date: '2017-03-22' },
      { version: 'Ruby 2.4.0',  date: '2016-12-25' },
      { version: 'Ruby 2.3.3',  date: '2016-11-21' },
      { version: 'Ruby 2.3.2',  date: '2016-11-15' },
      { version: 'Ruby 2.2.6',  date: '2016-11-15' },
      { version: 'Ruby 2.3.1',  date: '2016-04-26' },
      { version: 'Ruby 2.2.5',  date: '2016-04-26' },
      { version: 'Ruby 2.1.10', date: '2016-04-01' },
      { version: 'Ruby 2.1.9',  date: '2016-03-30' },
      { version: 'Ruby 2.3.0',  date: '2015-12-25' },
      { version: 'Ruby 2.2.4',  date: '2015-12-16' },
      { version: 'Ruby 2.1.8',  date: '2015-12-16' },
      { version: 'Ruby 2.2.3',  date: '2015-08-18' },
      { version: 'Ruby 2.1.7',  date: '2015-08-18' },
      { version: 'Ruby 2.2.2',  date: '2015-04-13' },
      { version: 'Ruby 2.1.6',  date: '2015-04-13' },
      { version: 'Ruby 2.2.1',  date: '2015-03-03' },
      { version: 'Ruby 2.2.0',  date: '2014-12-25' },
      { version: 'Ruby 2.1.5',  date: '2014-11-13' },
      { version: 'Ruby 2.1.4',  date: '2014-10-27' },
      { version: 'Ruby 2.1.3',  date: '2014-09-19' },
      { version: 'Ruby 2.1.2',  date: '2014-05-09' },
      { version: 'Ruby 2.1.1',  date: '2014-02-24' },
      { version: 'Ruby 2.1.0',  date: '2013-12-25' },
      { version: 'Ruby 2.0.0',  date: '2013-02-24' },
      { version: 'Ruby 1.9.3',  date: '2011-10-31' },
      { version: 'Ruby 1.9.2',  date: '2010-08-18' },
      { version: 'Ruby 1.9.1',  date: '2009-01-30' },
      { version: 'Ruby 1.8.7',  date: '2008-05-31' },
      { version: 'Ruby 1.9.0',  date: '2007-12-25' },
      { version: 'Ruby 1.8.6',  date: '2007-03-12' },
      { version: 'Ruby 1.8.5',  date: '2006-08-29' },
      { version: 'Ruby 1.8.4',  date: '2005-12-24' },
      { version: 'Ruby 1.8.3',  date: '2005-09-21' },
      { version: 'Ruby 1.8.2',  date: '2004-12-26' },
      { version: 'Ruby 1.8.0',  date: '2003-08-04' },
      { version: 'Ruby 1.6.7',  date: '2002-03-01' },
    ]

    grouped = releases.group_by {|row| Date.parse(row[:date]).year }

    grouping = releases.extend(SgroupBy).sgroup_by {|row| Date.parse(row[:date]).year }

    grouping.each {|year, rows| expect(rows).to eq(grouped[year]) }
  end
end
